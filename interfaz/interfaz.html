<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Visualización Robot - Streaming y Status (ROS2)</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f4f4f4; }
    .container { display: flex; height: 100vh; }
    .video-panel { flex: 3; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #222; color: #fff; }
    .video-panel h2 { margin-bottom: 10px; }
    #videoStream { max-width: 100%; max-height: 90%; border: 2px solid #444; border-radius: 8px; }
    .status-panel { flex: 1; padding: 20px; background: #fff; overflow-y: auto; box-shadow: -2px 0 5px rgba(0,0,0,0.1); }
    .status-panel h2 { margin-top: 0; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px 12px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background: #f0f0f0; }
    .delivered { color: green; font-weight: bold; }
    .pending { color: orange; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <div class="video-panel">
      <h2>Streaming Cámara del Robot (ROS2)</h2>
      <!-- Para servir la imagen desde ROS2:
           Instala y lanza el web_video_server en tu workspace:
             sudo apt install ros-<tu-distro>-web-video-server
             ros2 launch web_video_server web_video_server_launch.py
           Ajusta <HOST> al IP de tu máquina ROS2 y <TOPIC> al tópico de la cámara -->
      <img id="videoStream"
           src="http://<HOST>:8080/stream?topic=/camera/image_raw&type=mjpeg"
           alt="Video Stream" />
    </div>
    <div class="status-panel">
      <h2>Status de Entregas</h2>
      <table id="statusTable">
        <thead>
          <tr>
            <th>Trazador</th>
            <th>Cajas entregadas</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <!-- Filas dinámicas aquí -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Función para cargar el estatus desde una API REST (puede ser un nodo ROS2 con FastAPI, Express, etc.)
    async function fetchStatus() {
      try {
        const response = await fetch('/api/delivery-status');
        const data = await response.json();
        const tbody = document.querySelector('#statusTable tbody');
        tbody.innerHTML = '';
        data.forEach(item => {
          const row = document.createElement('tr');
          const trailerCell = document.createElement('td');
          trailerCell.textContent = item.trailer;
          const countCell = document.createElement('td');
          countCell.textContent = item.deliveredBoxes;
          const statusCell = document.createElement('td');
          statusCell.textContent = item.status;
          statusCell.className = item.status === 'Entregado' ? 'delivered' : 'pending';
          row.append(trailerCell, countCell, statusCell);
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error('Error al obtener el status:', err);
      }
    }

    // Actualizar cada 5 segundos
    setInterval(fetchStatus, 5000);
    // Carga inicial
    fetchStatus();
  </script>
</body>
</html>
